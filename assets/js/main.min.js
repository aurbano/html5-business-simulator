Simulator={config:{cycle:250,maxGrowth:100,needsRangeUnder:30,needsRangeOver:30,growthRate:1,minGrowthRate:1,debug:true,sickRate:.5,minSick:6,maxSick:100},start:function(){Simulator.layers={earth:$("#earth-img"),plant:$("#plant-img")};Simulator.sliders={sun:$("#palancas #sol").slider().data("slider"),water:$("#palancas #agua").slider().data("slider"),food:$("#palancas #nutrientes").slider().data("slider"),space:$("#palancas #espacio").slider().data("slider")};if(!Simulator.config.debug){console={log:function(a){}}}console.log("Launch simulator");Simulator.addLifecycle(function(){Simulator.Plant.update({water:-(Simulator.sliders.water.getValue()-100),food:-(Simulator.sliders.food.getValue()-100),sun:-(Simulator.sliders.sun.getValue()-100),space:-(Simulator.sliders.space.getValue()-100)})},true);Simulator.addLifecycle(function(){var a="ok";if(Simulator.Plant.sickness>=Simulator.config.maxSick){Simulator.stopLife();a="dead"}else if(Simulator.Plant.sickness>Simulator.config.minSick){a="sick"}var e=Math.round(Simulator.Plant.growth*5/100)+1;Simulator.layers.plant.attr("src","assets/img/planta/"+a+"/"+e+"-"+a+".png");if(a=="dead"){Simulator.layers.earth.hide();alert("La planta ha muerto")}if(Simulator.Plant.growth>=100){Simulator.stopLife();alert("Enhorabuena! La planta ha crecido al maximo")}});Simulator.startLife()},startLife:function(){Simulator.stopLife();Simulator.executeCycle();Simulator.lifeInterval=setInterval(function(){Simulator.executeCycle()},Simulator.config.cycle)},executeCycle:function(){var e=Simulator.lifecycle.length;if(e<1){Simulator.stopLife();console.log("Life stopped, no lifecycle functions!");return}for(var a=0;a<e;a++){Simulator.lifecycle[a]()}},stopLife:function(){clearInterval(Simulator.lifeInterval)},addLifecycle:function(a,e){Simulator.lifecycle.push(a);if(Simulator.lifeInterval===null&&e===true){Simulator.startLife()}},lifeInterval:null,lifecycle:[],Plant:{growth:0,sickness:0,state:"ok",problems:[],grow:function(a){if(Simulator.Plant.growth>=Simulator.config.maxGrowth){console.log("Maximum already");return}Simulator.Plant.growth+=a},needs:function(){return{water:{min:Math.max(0,Simulator.Plant.growth-Simulator.config.needsRangeUnder),max:Math.min(100,Simulator.Plant.growth+Simulator.config.needsRangeOver)},sun:{min:Math.max(0,Simulator.Plant.growth-Simulator.config.needsRangeUnder),max:Math.min(100,Simulator.Plant.growth+Simulator.config.needsRangeOver)},space:{min:Math.max(0,Simulator.Plant.growth-Simulator.config.needsRangeUnder),max:Math.min(100,Simulator.Plant.growth+Simulator.config.needsRangeOver)},food:{min:Math.max(0,Simulator.Plant.growth-Simulator.config.needsRangeUnder),max:Math.min(100,Simulator.Plant.growth+Simulator.config.needsRangeOver)}}},update:function(a){$("#palancas i").css({color:"#fff"});var t=true,e=0;if(Simulator.Plant.growth>=a.space){$("#space-img").css({color:"red"});t=false}needs=Simulator.Plant.needs();console.log("Plant needs: ",needs);if(a.water<needs.water.min||a.water>needs.water.max){$("#water-img").css({color:"red"});t=false;if(a.water<needs.water.min){e+=needs.water.min-a.water}else if(a.water>needs.water.max){e+=a.water-needs.water.max}}if(a.sun<needs.sun.min||a.sun>needs.sun.max){$("#sun-img").css({color:"red"});t=false;if(a.sun<needs.sun.min){e+=needs.sun.min-a.sun}else if(a.sun>needs.sun.max){e+=a.sun-needs.sun.max}}if(a.food<needs.food.min||a.food>needs.food.max){$("#food-img").css({color:"red"});t=false;if(a.food<needs.food.min){e+=needs.food.min-a.food}else if(a.food>needs.food.max){e+=a.food-needs.food.max}}if(t&&a.food>0&&a.sun>0&&a.water>0){var o=Simulator.config.growthRate*Math.max(Simulator.config.minGrowthRate,((a.water+a.sun+a.food)/3-needs.food.min)/needs.food.max);console.log("Growth = "+Simulator.Plant.growth+". Growing "+o);Simulator.Plant.sickness-=50*o*Simulator.config.sickRate;Simulator.Plant.state="ok";Simulator.Plant.grow(o)}else if(a.food===0&&a.sun===0&&a.water===0){console.log("Something is 0")}else{console.log("Not OK! Unbalance: "+e+", sickness: "+Simulator.Plant.sickness);Simulator.Plant.sickness+=e*Simulator.config.sickRate}Simulator.Plant.sickness=Math.max(Math.min(Simulator.Plant.sickness,100),0)},diff:function(a,e){return Math.abs(Math.abs(a)-Math.abs(e))},setProblem:function(a,e){Plant.problems[a]=e}}};